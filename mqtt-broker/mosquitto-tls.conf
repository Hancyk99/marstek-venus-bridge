# Mosquitto MQTT Broker - Secure TLS Configuration
# For production use with external access

# ============================================================================
# NETWORK LISTENERS
# ============================================================================

# Local unencrypted listener (only for Venus Poller within Docker network)
listener 1883 0.0.0.0
protocol mqtt
allow_anonymous true

# Secure TLS listener (for external/internet access)
listener 8883 0.0.0.0
protocol mqtt

# ============================================================================
# TLS/SSL CONFIGURATION (Port 8883)
# ============================================================================

# CA certificate (clients must trust this)
cafile /mosquitto/config/certs/ca.crt

# Server certificate and key
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key

# Require TLS protocol version 1.2 or higher
tls_version tlsv1.2

# Optional: Require client certificates (mutual TLS)
# Uncomment for maximum security
# require_certificate true

# ============================================================================
# AUTHENTICATION (Port 8883)
# ============================================================================

# Password file (create with: mosquitto_passwd -c passwordfile username)
password_file /mosquitto/config/passwordfile

# Disable anonymous access on TLS port
# allow_anonymous false  # Enable after creating password file

# ============================================================================
# LOGGING
# ============================================================================

log_dest stdout
log_type all
log_timestamp true

# ============================================================================
# PERSISTENCE
# ============================================================================

persistence true
persistence_location /mosquitto/data/

# ============================================================================
# SECURITY NOTES
# ============================================================================
#
# PORT 1883 (Unencrypted):
#   - Only accessible within Docker network
#   - Used by venus-poller container
#   - DO NOT expose to internet
#
# PORT 8883 (TLS):
#   - Encrypted with TLS 1.2+
#   - Password authentication required
#   - Safe to expose via port forwarding (if needed)
#   - Clients need ca.crt to verify server
#
# To create password file:
#   docker exec -it marstek-mosquitto mosquitto_passwd -c /mosquitto/config/passwordfile username
#
